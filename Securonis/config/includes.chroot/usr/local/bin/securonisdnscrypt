#!/bin/bash

# Securonis Linux - DNSCrypt Manager

set -e

# ASCII Art Function
ascii_art() {
    cat << "EOF"
 ________                                     _____           
 __  ___/______________  ________________________(_)_______   
 _____ \_  _ \  ___/  / / /_  ___/  __ \_  __ \_  /__  ___/   
 ____/ //  __/ /__ / /_/ /_  /   / /_/ /  / / /  / _(__  )    
 /____/ \___/\___/ \__,_/ /_/    \____//_/ /_//_/  /____/     
                                                              
 _____________   _________________                      _____ 
 ___  __ \__  | / /_  ___/_  ____/___________  ___________  /_
 __  / / /_   |/ /_____ \_  /    __  ___/_  / / /__  __ \  __/
 _  /_/ /_  /|  / ____/ // /___  _  /   _  /_/ /__  /_/ / /_  
 /_____/ /_/ |_/  /____/ \____/  /_/    _\__, / _  .___/\__/  
                                        /____/  /_/               
EOF
}

# Menu Function
menu() {
    ascii_art
    echo -e "\e[32m[Securonis Linux - DNSCrypt Manager]\e[0m"
    echo "1) Enable DNS Encryption"
    echo "2) Disable DNS Encryption"
    echo "3) Check DNS Status"
    echo "4) Exit"
}

# Function to check if command exists
command_exists() {
    command -v "$1" >/dev/null 2>&1
}

# Enable DNSCrypt
enable_dnscrypt() {
    echo "[+] Checking for dnscrypt-proxy..."
    if command_exists dnscrypt-proxy; then
        echo "[+] dnscrypt-proxy is already installed. Updating..."
        sudo apt update
        sudo apt upgrade -y dnscrypt-proxy
    else
        echo "[+] dnscrypt-proxy not found. Installing..."
        sudo apt update
        sudo apt install -y dnscrypt-proxy
    fi

    echo "[+] Configuring DNSCrypt service..."
    cd /etc/dnscrypt-proxy || { echo "Directory /etc/dnscrypt-proxy not found."; return 1; }
    sudo dnscrypt-proxy -service install
    sudo dnscrypt-proxy -service start

    echo "[✔] DNSCrypt has been successfully enabled!"
}

# Disable DNSCrypt
disable_dnscrypt() {
    echo "[!] Disabling DNS Encryption..."
    sudo dnscrypt-proxy -service stop
    sudo dnscrypt-proxy -service uninstall

    echo "[✔] DNS Encryption has been disabled!"
}

# Check DNS Status
check_status() {
    echo "[+] DNSCrypt Service Status:"
    sudo systemctl status dnscrypt-proxy | grep "Active:"
}

# Main Menu Loop
while true; do
    menu
    read -p "Enter your choice: " choice

    case $choice in
        1) enable_dnscrypt ;;
        2) disable_dnscrypt ;;
        3) check_status ;;
        4) echo "Exiting..."; exit 0 ;;
        *) echo "Invalid choice! Please select a valid option.";;
    esac

    echo -e "\nPress any key to continue..."
    read -n 1 -s -r
done
